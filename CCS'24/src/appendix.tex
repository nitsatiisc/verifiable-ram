\appendix

\section{Argument for RAM From Polynomial Protocols}\label{sec:poly-proto-ram-app}
In this section, we give a self-contained argument of knowledge for membership in the language
$\LRAM{I}{m}{m}$ introduced in Section \ref{sec:model-for-ram}. We first consider the polynomial encoding
of different RAM artefacts.
\subsection{Polynomial Encoding}\label{subsec:poly-encoding}
%The aim of this section is to encode artefacts such as RAM state, operations and transcripts as polynomials, and
%translate checking memory consistency (equivalently, checking membership in $\LRAM{I}{n}{m}$) to checking polynomial identities
%over the encoded polynomials. For
%simplicity and its usefulness later, we consider the case $m=n$, and accordingly check the membership in the language $\LRAM{I}{m}{m}$.
Let $k=3m$ and let $\omega$ be the $k^{th}$ root of unity in $\F$.
Let $\nu=\omega^3$, and thus $\nu$ is an $m^{th}$ root of unity in $\F$ (We assume, these roots exist in $\F$).
We define sets $\setH$ and $\setV$ below consisting of $k^{th}$ and $m^{th}$ roots of unity respectively.
\begin{gather}\label{eq:interpolation-sets}
\setH = \{\omega,\ldots,\omega^k\},\quad \setV = \{\nu,\ldots,\nu^m\}
\end{gather}
Let $\{\lambda_i(X)\}_{i=1}^k$ be lagrange basis polynomials
for the set $\setH$ and $\{\tau_i(X)\}_{i=1}^m$ be the lagrange polynomials for the set $\setV$ satisfying
$\lambda_i(\omega^j)=\delta_{ij}$ for $i,j\in [k]$ and $\tau_i(\nu^j)=\delta_{ij}$ for $i,j\in [m]$.
We use $\setH$ to encode a vector $\vec{f}=(f_1,\ldots,f_k)$ of size $k$ as the polynomial $f(X)\in \F_{<k}[X]$ such that $f(\omega^i)=f_i$ for $i\in [k]$.
Similarly, we use $\setV$ to encode a vector
$\vec{g}=(g_1,\ldots,g_m)$ of size $m$ as the polynomial $g(X)\in F_{<m}[X]$ such that $g(\nu^i)=g_i$ for $i\in [m]$. We use
the notation $\enc{f}{\setH}$ and $\enc{g}{\setV}$ to denote polynomial encodings of vectors $\vec{f}\in \F^k$ and $\vec{g}\in \F^m$
respectively.
In the other direction, for a polynomial $f(X)\in \F[X]$,
we use $\vec{f}_{|_\setH}$ and $\vec{f}_{|_\setV}$ to denote the vectors $(f(\omega^1),\ldots,f(\omega^k))$ and $(f(\nu^1),\ldots,f(\nu^m))$ respectively.
The encoding of vectors as polynomials can be succinctly described using lagrange basis polynomials.
Then we have $\enc{f}{\setH}=\sum_{i=1}^k f_i\lambda_i(X)$ and $\enc{g}{\setV}=\sum_{i=1}^m g_i\tau_i(X)$.

We extend the encoding of vectors to encode RAM, operations and transcripts.
For a RAM $T=(\vec{a},\vec{v})\in \RAM{I}{m}$, we define its encoding
$\wt{T}=(a(X),v(X))$ where $a(X),v(X)\in \F_{<m}[X]$ encode vectors $\vec{a}, \vec{v}$ respectively.
Given an operation sequence
$\vec{o}=(o_1,\ldots,o_m)$ with $o_i=(\bar{\op}_i,\bar{a}_i,\bar{v}_i)$ we encode $\vec{o}$ as $\wt{O}=(\bar{\op}(X),\bar{a}(X),\bar{v}(X))$
where $\bar{\op}(X)$ encodes the
vector $\vec{\op}=(\bar{\op}_1,\ldots,\bar{\op}_m)$, $\bar{a}(X)$ encodes the vector $(\bar{a}_1,\ldots,\bar{a}_m)$ and $\bar{v}(X)$
encodes the vector $(\bar{v}_1,\ldots,\bar{v}_m)$.
Finally, a transcript $\tr=(\vec{t},\vec{\op},\vec{A},\vec{V})$ for tuples $(T,\vec{o},T')$ where $T,T'$ are RAMs of size $m$, and $\vec{o}$ is an
operation sequence of size $m$ is encoded as $\wt{\tr}$ $=$ $(t(X)$, $\op(X)$, $A(X)$, $V(X))$ where the polynomials
encode the respective vectors in $\F^k$.

\subsection{Relations over Polynomial Encodings}\label{subsec:encoded-relations}
In this section, we describe polynomial checks for two important relations we need in subsequent sections, viz,
(i) checking concatenation of vectors and (ii) checking monotonicity and load-store consistency of a transcript. Let
$k,m$ be integers with $k=3m$ as in previous section. The lemma below specifies the polynomial checks for verifying
that vector $\vec{v}\in \F^k$ is concatenation of vectors $\vec{a},\vec{b},\vec{c}$ in $\F^m$.

\begin{lemma}\label{lem:vec-concatenation}
Let $\vec{a},\vec{b},\vec{c}\in \F^m$  and $v\in \F^k$ be vectors encoded by polynomials
$a(X),b(X),c(X)$ and $v(X)$ respectively. Then,
    {\small
\begin{align}
    a(X^3) - v(X)  &= 0  \quad \text{ mod $Z(X)$ } \tag{A1}\label{eq:A1}\\
    b(X^3) - v(\omega^m X)  &= 0   \quad \text{ mod $Z(X)$ } \tag{A2}\label{eq:A2}\\
    c(X^3) - v(\omega^{2m} X) &= 0 \quad \text{ mod $Z(X)$ } \tag{A3}\label{eq:A3}
\end{align}
}
for $Z(X)=\prod_{i=1}^m (X-\omega^i)$ if and only if $\vec{v}=\vec{a}||\vec{b}||\vec{c}$.
\end{lemma}
\begin{proof}
    Assume that the polynomial identities hold. Substituting $X=\omega^i$ for $i\in [m]$ in above equations implies
    for $i\in [m]$: $a_i=v_i$ (Eq \eqref{eq:A1}), $b_i=v_{m+i}$ (Eq \eqref{eq:A2}) and $c_i=v_{2m+i}$ (Eq \eqref{eq:A3}),
    which together imply $\vec{v}=\vec{a}||\vec{b}||\vec{c}$. Converse follows by observing that $\vec{v}=\vec{a}||\vec{b}||\vec{c}$
    implies that $v(X) = a(X^3)$, $v(\omega^m X)=b(X^3)$ and $v(\omega^{2m} X)=c(X^3)$ holds for all $X=\omega^i, i\in [m]$.
    Thus, the equalities hold modulo the polynomial $Z(X)$ as defined above.
\end{proof}

Next, we specify polynomial checks on the encoding of a transcript to ensure it satisfies address-ordering and load-store consistency.
Let $\tr=(\vec{t},\vec{\op},\vec{A},\vec{V})$ be a transcript encoded as
$\wt{\tr}=(t(X),\op(X),A(X),V(X))$. Recall that we need to check two conditions on $\tr$, viz (i) {\em monotonicty}:
the transcript is sorted by address and timestamp respectively, i.e, $A_i\leq A_{i+1}$ for all $i < k$ and
$t_i < t_{i+1}$ when $A_i=A_{i+1}$, (ii) {\em load-store consistency}: whenever $\op_{i+1}=0$ and $A_i=A_{i+1}$,
we have $V_i=V_{i+1}$. To do so, we exhibit disjoint sets $I_1,I_2$ with $I_1\uplus I_2=[k]$ such that: (i) for all
$i\in I_1$, $A_i < A_{i+1}$, (ii) for all $i\in I_2$, $(A_i = A_{i+1})\wedge (t_i < t_{i+1})$ and (iii) for all $i\in I_2$,
$(\op_i=1)\vee (V_i = V_{i+1})$. We note that the conditions on the sets $I_1$ and $I_2$ ensures monotonicity.
Moreover it can be seen that load-store consistency requirements are satisfied for all $i\in I_1$ (as $A_i\neq A_{i+1}$).
Similarly,load-store consistency also holds for all $i\in I_2$.
It remains to exhibit the sets and show that they satisfy the above invariants using polynomials, as in the following
lemma:
\begin{lemma}\label{lem:addr-ordered-transcript}
Let $\wt{\tr}$ be a polynomial encoding of transcript $\tr$ of size $k$, given by polynomials $t(X),\op(X),A(X)$ and $V(X)$.
Then for $kN<|\F|$, $\tr$ is address ordered and satisfies load-store consistency if and only if there exist polynomials
$Z_1,Z_2,\delta_T,\delta_A$
such that the following hold:
    {\small
\begin{align}%\label{eq:loadstore-consitency-constraints}
    & Z_2(X)(A(\omega X) - A(X) - \delta_A(X)) = 0 \text{ mod } \mathbb{Z}_\setH(X) \tag{C1} \label{eq:C1} \\
    & A(\omega X) - A(X) = 0  \text{ mod } Z_2(X) \tag{C2} \label{eq:C2} \\
    & t(\omega X) - t(X) - \delta_T(X) = 0  \text{ mod } Z_2(X) \tag{C3} \label{eq:C3} \\
    & (\op(X) - 1)(V(\omega X) - V(X)) = 0  \text{ mod } Z_2(X) \tag{C4} \label{eq:C4} \\
    & Z_1(X)\cdot Z_2(X) = \mathbb{Z}_\setH(X) \quad  \tag{C5} \label{eq:C5} \\
    & 1\leq A(\omega) < N  \quad \tag{C6} \label{eq:C6} \\
    & 1\leq t(\omega^i) < N, 1\leq \delta_A(\omega^i)<N,\ 1\leq \delta_T(\omega^i)<N \text{ for } i\in [k] \tag{C7} \label{eq:C7}
\end{align}
}
\end{lemma}

\begin{figure}[htbp]
	\centering
	\begin{mdframed}
		{\footnotesize
			\noindent{\bf Common Input}: Commitments $c_t$, $c_{op}$, $c_A$ and $c_V$ to $t,op,A$ and $V$ respectively. 
			\begin{enumerate}[leftmargin=2em]
				\item $\prover\rightarrow\verifier$: $\prover$ sends $\gone{\Z_\setH}$, $\gone{Z_2}$, $\gone{\delta_T}$, $\gone{\delta_A}$
				\item $\verifier\rightarrow\prover$: Verifier sends $\gamma\gets \F$.
				\item $\prover$ computes:
				\begin{align}
					& Q_1(X) =  Z_2(X) (A(\omega X) - A(X) - \delta_A(X)) / \Z_\setH(X)\\
					& Q_2(X) =  (A(\omega X) - A(X)) / Z_2(X) \\
					& Q_3(X) = (t(\omega X) - t(X) - \delta_T(X)) / Z_2(X) \\
					& Q_4(X) = (\op(X) - 1)(V(\omega X) - V(X)) / Z_2(X)
				\end{align}
				\item $\prover\rightarrow\verifier$: Sends commitment $\gone{Q_1}$, $\gone{Q_2}$, $\gone{Q_3}$ and $\gone{Q_4}$ to $Q_1(X)$, $Q_2(X)$, $Q_3(X)$ and $Q_4(X)$.
				\item $\verifier\rightarrow\prover$: Sends $s\gets\F$.
				\item $\prover\rightarrow\verifier$: Sends evaluations $\val{s}{A}=A(s)$, $\val{\omega s}{A}=A(\omega s)$, $\val{s}{\delta_A} = \delta_A(s)$, $\val{s}{t}=t(s)$, $\val{\omega s}{t}=t(\omega s)$, $\val{s}{\delta_T} = \delta_T(s)$, $\val{s}{\op}=\op(s)$, $\val{s}{V}=V(s)$, $\val{\omega s}{V}=V(\omega s)$, $\val{s}{Q_1}=Q_1(s)$, $\val{s}{Q_2}=Q_2(s)$, $\val{s}{Q_3}=Q_3(s)$, $\val{s}{Q_4}=Q_4(s)$, $\val{s}{Z_2}=Z_2(s)$, $\val{s}{\Z_\setH}=\Z_\setH(s)$.
				\item $\verifier\rightarrow\prover$: Sends $r\gets\F$.
				\item $\prover\rightarrow\verifier$: Sends $\kzg$ proofs:
								\begin{itemize}[leftmargin=2em]
										\item $\Pi_{F_1}=\kzgprove(\srs,F_1,\omega s)$, where $F_1(X) = A(X) + r t(X) + r^2 V(X)$
										\item $\Pi_{F_2}=\kzgprove(\srs,F_2,s)$ where $F_2(X) = A(X) + r t(X) + r^2 \op(X) + r^4 V(X) + r^5 \delta_A + r^6 \delta_T(X) + r^7 Z_2(X) + r^8 \Z_\setH(X) + r^{9} Q_1(X) + r^{10} Q_2(X) + r^{11} Q_3(X) + r^{12} Q_4(X)$
									\end{itemize}
%				\item $\prover\rightarrow\verifier$: Sends $\rangeproof$ proofs:
%				\begin{itemize}[leftmargin=2em]
%					\item $\Pi_{F_1}=\rangeproof(\srs,[N],\val{\omega}{A})$
%				\end{itemize}
				\item $\verifier$ computes: Compute commitments $\gone{F_1}$ and $\gone{F_2}$ using homomorphism. It then checks:
								\begin{itemize}[leftmargin=2em]
									\item $\kzgverify(\srs,\gone{F_1},\omega s, \val{\omega s}{A}+r \val{\omega s}{t} + r^2 \val{\omega s}{V},\Pi_{F_1})$.
									\item $\kzgverify(\srs,\gone{F_2}, s, \val{s}{A}=A(s) + r \val{s}{t}=t(s) + r^2 \val{s}{\op}=\op(s) + r^4 \val{s}{V}=V(s) + r^5 \val{s}{\delta_A}=\delta_A(s) + r^6 \val{s}{\delta_T}=\delta_T(s) + r^7 \val{s}{Z_2}=Z_2(s) + r^8 \val{s}{\Z_\setH}=\Z_\setH(s) + r^{9} \val{s}{Q_1}=Q_1(s) + r^{10} \val{s}{Q_2}=Q_2(s) + r^{11} \val{s}{Q_3}=Q_3(s) + r^{12} \val{s}{Q_4}=Q_4(s), \Pi_{F_2})$.
									\item $\val{s}{Q_1}\cdot \val{s}{\Z_\setH} =? \val{s}{Z_2} (\val{\omega s}{A} - \val{s}{A} - \val{s}{\delta_A})$
									\item  $\val{s}{Q_2}\cdot \val{s}{Z_2} =? (\val{\omega s}{A} - \val{s}{A})$
									\item $\val{s}{Q_3}\cdot \val{s}{Z_2} =? (\val{\omega s}{t} - \val{s}{t} - \val{s}{\delta_A})$
									\item $\val{s}{Q_4}\cdot \val{s}{Z_2} =? (\val{s}{\op}-1)(\val{\omega s}{V} - \val{s}{V})$
								\end{itemize}
				\item $\verifier$ outputs: Accept if all the above checks succeeds, otherwise it rejects.
			\end{enumerate}
		}
	\end{mdframed}
	\vspace*{-5mm}
	\caption{Protocol: Check relations over polynomial encodings}
	\label{fig:encoded-relations}
\end{figure}

\begin{figure}[htbp]
	\centering
	\begin{mdframed}
		{\footnotesize
			\noindent{\bf Common Input}: Commitments $c_a$, $c_b$, $c_c$ and $c_v$ to $a,b,c$ and $v$ respectively. Commitment $\gone{Z}$ to the polynomial
			$Z(X)=\prod_{i=1}^m (X-\omega^i)$.
			\begin{enumerate}[leftmargin=2em]
				\item $\verifier\rightarrow\prover$: Verifier sends $\gamma\gets \F$.
				\item $\prover$ computes:
				\begin{align}
					& h(X) = a(X) + \gamma b(X) + \gamma^2 c(X),\\
					& Q(X) = (h(X^3) - v(X) - \gamma v(\omega^m X) - \gamma^2 v(\omega^{2m} X))/Z(X)
				\end{align}
				\item $\prover\rightarrow\verifier$: Sends commitment $\gone{Q}$ to $Q(X)$.
				\item $\verifier\rightarrow\prover$: Sends $s\gets\F$.
				\item $\prover\rightarrow\verifier$: Sends evaluations $\val{s}{v}=v(s)$, $\val{\omega^m s}{v}=v(\omega^m s)$,
				$\val{\omega^{2m}s}{v}=v(\omega^{2m} s)$, $\val{s^3}{h}=h(s^3)$, $\val{s}{Q}=Q(s)$ and $\val{s}{Z}=Z(s)$.
				\item $\verifier\rightarrow\prover$: Sends $r\gets\F$.
				\item $\prover\rightarrow\verifier$: Sends $\kzg$ proofs:
				\begin{itemize}[leftmargin=2em]
					\item $\Pi_v=\kzgprove(\srs,v,(s,\omega^m s, \omega^{2m}s))$.
					\item $\Pi_h=\kzgprove(\srs,h,s^3)$.
					\item $\Pi_f=\kzgprove(\srs,f,s)$ where $f(X)=Z(X) + rQ(X)$.
				\end{itemize}
				\item $\verifier$ computes: Compute commitments $\gone{h}$ and $\gone{f}$ using homomorphism. It then checks:
				\begin{itemize}[leftmargin=2em]
					\item $\kzgverify(\srs,\gone{v},(s,\omega^m s, \omega^{2m}s), (\val{s}{v}, \val{\omega^m s}{v}, \val{\omega^{2m} s}{v}),\Pi_v)$.
					\item $\kzgverify(\srs,\gone{h}, s^3, \val{s^3}{h},\Pi_h)$.
					\item $\kzgverify(\srs,\gone{f}, s, \val{s}{Z} + r\val{s}{Q}, \Pi_f)$.
					\item $\val{s}{Q}\cdot \val{s}{Z} =? \val{s^3}{h}-\val{s}{v}-\gamma \val{\omega^m s}{v}-\gamma^2\val{\omega^{2m}s}{v}$.
				\end{itemize}
				\item $\verifier$ outputs: Accept if all the above checks succeeds, otherwise it rejects.
			\end{enumerate}
		}
	\end{mdframed}
	\vspace*{-5mm}
	\caption{Protocol: Check concatenation via commitments}
	\label{fig:concatenation}
\end{figure}

\section{Succinct Argument for Verifiable RAM}\label{sec:poly-proto-ram}
The polynomial encodings in the previous section can be used to polynomial protocol for
checking the membership in the language $\LRAM{I}{m}{m}$ for $m\in \N$. The polynomial protocol can be subsequently
be compiled into a succinct argument using an extractable polynomial commitment scheme.
In this section, we use $\kzg$ polynomial commitment scheme to obtain a succinct argument for checking membership in $\LRAM{I}{m}{m}$
in the Algebraic Group Model (AGM).
At a high level, to prove $(\vec{T},\vec{o},\vec{T'})\in \LRAM{I}{m}{m}$, the prover
constructs time ordered transcript $\tr$ and then permutes it to obtain the address sorted transcript $\tr^\ast$.
It then sends the polynomial encodings of $\vec{T},\vec{o},\vec{T'},\tr$ and $\tr^\ast$ to the verifier, who verifies that:
\begin{enumerate}[leftmargin=1em]
    \item The time ordered transcript is correctly constructed, i.e, $\tr=\TOT(\vec{T},\vec{o},\vec{T'})$.
    \item The transcript $\tr^\ast$ is a permutation of the transcript $\tr$, i.e, $\tr^\ast=\sigma(\tr)$ for some permutation $\sigma$ of $[k]$.
    \item The transcript $\tr^\ast$ is address ordered and satisfies load-store consistency.
\end{enumerate}
In fact, we consider memebership in the above language under commitments. Let $\srs$ denote a $\kzg$ setup over a bilinear group, with
prime order groups $\Gone, \Gtwo$ and $\GT$. We canonically commit to RAM, operation sequences and transcripts by committing to their
polynomial encodings. Commitment of an encoding represented as tuple of polynomials is simply the tuple consisting of commitments of the component
polynomials. We now define
the relation $\CLRAM$ below, and present a succinct argument for the same.
\begin{definition}\label{defn:committed-vram}
Let $\CLRAM$ consist of tuples $((c_T, c_o, c_T'), (T, \vec{o},T'))$ where $c_T$ $=$ $\kzgcommit(\srs, \wt{T})$,
$c_T'$ $=$ $\kzgcommit(\srs, \wt{T'})$,
$c_o$ $=$ $\kzgcommit(\srs,\wt{O})$ commit to $T$, $T'$ and $\vec{o}$ with $(T,\vec{o},T')\in \LRAM{I}{m}{m}$.
\end{definition}
\noindent In the above definition we have $c_T=(c_a,c_v)$ where $c_a$ and $c_v$ are $\kzg$ commitments to polynomials $a(X)$ and $v(X)$ in
the encoding $\wt{T}=(a(X), v(X))$. Similarly we parse $c_T'=(c_a', c_v')$ and $c_o=(\bar{c}_\op, \bar{c}_a, \bar{c}_v)$ (see Section
\ref{subsec:poly-encoding} for polynomial encodings).
For proving relation \ref{defn:committed-vram}, prover's input consists of initial RAM state $T=(\vec{a},\vec{v})$,
final RAM state $T'=(\vec{a'},\vec{v'})$, operation sequence $\vec{o}=(o_1,\ldots,o_m)$ with $o_i=(\bar{\op}_i,\bar{a}_i,\bar{v}_i)$,
time-ordered transcript $\tr=(\vec{t},\vec{\op},\vec{A},\vec{V})$ and address-ordered transcript $\tr^\ast=(\vec{t^\ast},\vec{\op^\ast},
\vec{A^\ast},\vec{V^\ast})$ obtained from $\tr$ using a permutation $\sigma:[k]\rightarrow [k]$. Verifier's input consists of the
commitments $c_T, c_o$ and $c_T'$ as described above.

The prover starts the protocol by sending commitments $c_\tr$ and $c^\ast_\tr$ to the transcripts $\tr$ and $\tr^\ast$ respectively.
To show that $\tr$ is correctly formed, the prover needs to prove the concatenations:
(i) $\vec{\op}=0^m||(\bar{\op}_1,\ldots,\bar{\op}_m)||0^m$, (ii) $\vec{A}=\vec{a}||(\bar{a}_1,\ldots,\bar{a}_m)||\vec{a'}$
and (iii) $\vec{V}=\vec{v}||(\bar{v}_1,\ldots,\bar{v}_m)||\vec{v'}$. Note that the time-stamp column $\vec{t}$ is implicitly assumed
to be $(1,\ldots,k)$.
The verifier checks the concatenations using Lemma \ref{lem:vec-concatenation}.
It uses a random challenge $\beta$ to reduce the three concatenations to one concatenation, and uses another challenge $\gamma$
to reduce the three polynomial checks in Lemma \ref{lem:vec-concatenation} to a single check.
The complete polynomial protocol is detailed in Figure \ref{fig:time-ordered-transcript}.

%\begin{tcolorbox}
\begin{figure}[htbp]
    \centering
    \begin{mdframed}
    {\footnotesize
    \noindent{\bf Common Input}: Commitments $c_T=(c_a,c_v)$, $c_o=(\bar{c}_\op, \bar{c}_a, \bar{c}_v)$, $c_T'=(c_a', c_v')$
        and $c_\tr=(c_t, c_\op, c_A, c_V)$ to $T,o,T'$ and $\tr$ respectively. Commitment $\gone{Z}$ to the polynomial
        $Z(X)=\prod_{i=1}^m (X-\omega^i)$.
        \begin{enumerate}[leftmargin=2em]
            \item $\verifier\rightarrow\prover$: Verifier sends $\beta,\gamma\gets \F$.
            \item $\prover$ computes:
            \begin{align}\label{eq:poly-constraints}
            & G_1(X) = a(X) + \beta v(X),\, G_2(X) = \bar{a}(X) + \beta \bar{v}(X) + \beta^2 \bar{\op}(X) \tag{A1} \\
            & G_3(X) = a'(X) + \beta v'(X),\, G(X) = A(X) + \beta V(X) + \beta^2 \op(X) \tag{A2} \\
            & H(X) = G_1(X) + \gamma G_2(X) + \gamma^2 G_3(X), \tag{A3} \\
            & Q(X) = (H(X^3) - G(X) - \gamma G(\omega^m X) - \gamma^2 G(\omega^{2m} X))/Z(X) \tag{A4}
            \end{align}
            \item $\prover\rightarrow\verifier$: The prover sends commitment $\gone{Q}$ to $Q(X)$.
            \item $\verifier\rightarrow\prover$: Sends $s\gets\F$.
            \item $\prover\rightarrow\verifier$: Sends evaluations $\val{s}{G}=G(s)$, $\val{\omega^m s}{G}=G(\omega^m s)$,
            $\val{\omega^{2m}s}{G}=G(\omega^{2m} s)$, $\val{s^3}{H}=H(s^3)$, $\val{s}{Q}=Q(s)$ and $\val{s}{Z}=Z(s)$.
            \item $\verifier\rightarrow\prover$: Sends $r\gets\F$.
            \item $\prover\rightarrow\verifier$: Sends $\kzg$ proofs:
            \begin{itemize}[leftmargin=2em]
                \item $\Pi_G=\kzgprove(\srs,G,(s,\omega^m s, \omega^{2m}s))$.
                \item $\Pi_H=\kzgprove(\srs,H,s^3)$.
                \item $\Pi_F=\kzgprove(\srs,F,s)$ where $F(X)=Z(X) + rQ(X)$.
            \end{itemize}
            \item $\verifier$ computes: Compute commitments $\gone{G},\gone{H}$ and $\gone{F}$ using homomorphism. It then checks:
            \begin{itemize}[leftmargin=2em]
                \item $\kzgverify(\srs,\gone{G},(s,\omega^m s, \omega^{2m}s), (\val{s}{G}, \val{\omega^m s}{G}, \val{\omega^{2m} s}{G}),\Pi_G)$.
                \item $\kzgverify(\srs,\gone{H}, s^3, \val{s^3}{H},\Pi_H)$.
                \item $\kzgverify(\srs,\gone{F}, s, \val{s}{Z} + r\val{s}{Q}, \Pi_F)$.
                \item $\val{s}{Q}\cdot \val{s}{Z} =? \val{s^3}{H}-\val{s}{G}-\gamma \val{\omega^m s}{G}-\gamma^2\val{\omega^{2m}s}{G}$.
            \end{itemize}
            \item $\verifier$ outputs: Accept if all the above checks succeeds, otherwise it rejects.
        \end{enumerate}
    }
    \end{mdframed}
    \vspace*{-5mm}
    \caption{Protocol: Check correctness of time-ordered transcript}
    \label{fig:time-ordered-transcript}
\end{figure}
%\end{tcolorbox}

Next, we show a polynomial protocol for proving that the transcript $\tr^\ast$ is a permutation of the transcript $\tr$.
We first recall the permutation argument for vectors from ~\cite{EPRINT:GabWilCio19}.
\begin{lemma}[Permutation Check \cite{EPRINT:GabWilCio19}]\label{lem:perm-argument}
Let $f(X), g(X)$ be polynomials in $\F[\,X\,]$. Then, the vectors $\vec{f}, \vec{g}\in \F^k$ encoded by the polynomials
are permutations of each other if and only if with overwhelming probability over the choice of $\alpha\gets \F$,
there exists a polynomial $z(X)$ satisfying the polynomial constraints:
    {\small
\begin{align}
    \lambda_1(X)(z(X) -1) &= 0 \text{ mod } Z_\setH(X) \tag{B1} \label{eq:B1} \\
    (\alpha - g(X))z(\omega X) &= (\alpha - f(X))z(X) \text{ mod } Z_\setH(X) \tag{B2} \label{eq:B2}
\end{align}
}
\end{lemma}
The polynomial protocol in Figure \ref{fig:permutated-transcripts} essentially invokes the above argument on
the random linear combination of the columns of the respective transcripts.
%\begin{tcolorbox}
\begin{figure}[htbp]
    \centering
    \begin{mdframed}
    {\footnotesize
    \noindent{\bf Common Input}: Commitments $c_\tr=(c_t,c_\op,c_A, c_V)$ and $c_\tr^\ast=(c_t^\ast,c_\op^\ast, c_A^\ast, c_V^\ast)$
        of transcripts $\tr$ and $\tr^\ast$ respectively.
        \begin{enumerate}[leftmargin=2em]
            \item $\verifier\rightarrow\prover$: Sends $\alpha,\beta, \chi\gets \F$
            \item $\prover$ computes $f(X)=t(X) + \beta \op(X) + \beta^2 A(X) + \beta^3 V(X)$, $g(X) = t^\ast(X) + \beta \op^\ast(X)$
            $+ \beta^2 A^\ast(X) + \beta^3 V^\ast(X)$. It then computes polynomials $z(X),q(X)$ as:
            \begin{itemize}[leftmargin=1em]
                \item Interpolate polynomial $z(X)$ of degree $k-1$ such that $z(\omega)=1$ and
                $z(\omega^{i+1})=\prod_{j=1}^i (\alpha - f(\omega^j))/(\alpha - g(\omega^j))$ for $1\leq i\leq k$.
                \item Compute $q(X) = ((\alpha - g(X))z(\omega X) - (\alpha - f(X))z(X) + \chi\lambda_1(X)(z(X) - 1))/\mathbb{Z}_{\setH}(X)$.
            \end{itemize}
            \item $\prover\rightarrow\verifier$: Sends commitments $\gone{z}$ and $\gone{q}$ to polynomials $z(X)$ and $q(X)$ respectively.
            \item $\verifier$ computes: The verifier checks that $q(X)Z_\setH(X)$ = $(\alpha - g(X))z(\omega X)-(\alpha - f(X))z(X) + \chi\lambda_1(X)(z(X) - 1)$
            by requesting evaluations and $\kzg$ proofs of polynomials $f,g$ and $q$ at a random point. It accepts if the check succeeds.
        \end{enumerate}
    }
    \end{mdframed}
    \vspace*{-5mm}
    \caption{Protocol: Check permutation of transcripts}
    \label{fig:permutated-transcripts}
\end{figure}
%\end{tcolorbox}
Finally, we see that Lemma \ref{lem:addr-ordered-transcript} implies a polynomial protocol to check that the transcript
$\tr^\ast$ is address ordered and satisfies load-store consistency. We skip the formal protocol details, which
essentially involves the prover identifying sets
$I_1, I_2$ as described in Section \ref{subsec:encoded-relations} and sending auxiliary polynomials $Z_1(X),Z_2(X),\delta^\ast_A(X)$ and $\delta^\ast_T(X)$ to the verifier.
The verifier then checks the identities (C1)-(C6) in Lemma \ref{lem:addr-ordered-transcript}.
The range checks in (C7) can be checked using polynomial protocols in sub-vector lookup arguments such as Caulk+ ~\cite{EPRINT:PosKat22}, CQ
~\cite{EPRINT:EagFioGab22}. For completeness, we also include a protocol for enforcing range checks using committed index lookup
described in Section \ref{subsec:committed-index-lookup}.


\section{Proof of Lemma \ref{lem:sum computation}}
Recall the statement of lemma \ref{lem:sum computation}. We want to compute $e_i$ for all $i \in \setind$ and $b_j$ for all $j \in K$ in $O(|K|\log^2|K|)$ $\mathbb{F}$ operations.\\\\

Before starting the proof, we list some preliminaries and some lemmas/facts which will be useful in the proof.\\

\subsection{Computational Algebra Preliminaries}
Let $\F$ be a finite field of prime order $p$ and $\G$ be a cyclic additive group of order $p$ with generator $g$. For $s \in \F$, we use
the notation $\elt{s}$ to denote the group element $s\cdot g$. Assume that $\F$ contains $n^{th}$ root of unity $\xi$
satisfying $\xi^n=1$ for large $n$ (All polynomial degrees are assumed less than $n$).

\begin{fact}[\textsf{Fast Evaluation}]\label{fc:fft}
Let $f\in \F[X]$ be a polynomial of degree $<d$ and $(\xi_1,\ldots,\xi_r)\in \F^r$ be distinct points in $\F$.
Then the vector $(f(\xi_1),\ldots,f(\xi_r))$ can be computed in $O((d+r)\log (d+r))$ $\F$ operations if $\xi_1,\ldots,\xi_r$ form roots
of unity, and in $O((d+r)\log^2(d+r))$ $\F$ operations otherwise.
\end{fact}

\begin{fact}[\textsf{Fast Interpolation}]\label{fc:ifft}
Let $\xi_1,\ldots,\xi_d$ be distinct points in $\F$ and $(v_1,\ldots,v_d)\in \F^d$. Then $(f_0,\ldots,f_{d-1})\in \F^d$
can be computed in $O(d\log^2 d)$ operations in $\F$ such that $f(\xi_i)=v_i$ for all $i\in [d]$ where
$f(X)=\sum_{i=0}^{d-1}f_iX^i$.
\end{fact}

\begin{fact}[\textsf{Fast Multiplication}]\label{fc:mult}
Let $\xi_1,\ldots,\xi_r$ be distinct points in $\F$. Then coefficients of $f(X)=\prod_{i=1}^r (X-\xi_i)$
can be computed in $O(r\log^2 r)$ operations in $\F$.
\end{fact}

\begin{fact}[\textsf{Multi KZG proofs}]\label{fc:multkzg}
Let $\{\elt{x^i}\}_{i=1}^d$ be given for some $x\in \F$. Then for set of $r$ distinct points $\xi_1,\ldots,\xi_r$,
and a polynomial $f(X)\in \F[X]$ of degree $<d$,the vector $(\elt{h_1(x)},\ldots,\elt{h_r(x)})$,
where $h_i(X) = (f(X) - f(\xi_i))/(X - \xi_i)$ can be computed in
$O((r+d)\log(r+d))$ group and field operations when $\xi_1,\ldots,\xi_r$ are roots of unity, and in
$O(rlog^2 r + d\log d)$ group and field operations otherwise.
\end{fact}

\begin{fact}[\textsf{Lagrange Polynomials}]\label{fc:lagrange}
Let $\mathbb{S}=\{\xi_1,\ldots,\xi_r\}$ be a set of $r$ distinct points and let $\tau_1(X),\ldots,\tau_r(X)$ be
the corresponding lagrange polynomials of degree $r-1$ each. Let $Z_{\mathbb{S}}(X)=\prod_{i=1}^r (X-\xi_r)$ denote the vanishing polynomial
for $\mathbb{S}$. Then we have:
\begin{gather*}
    \sum_{i=1}^r \tau_i(X) = 1 \\
    \tau_i(X) = \frac{Z_{\mathbb{S}}(X)}{Z_{\mathbb{S}}'(\xi_i)(X-\xi_i)} \text{ for all } i\in [r]
\end{gather*}
\end{fact}

\subsection{Notion of derivative in finite field setting}

\textbf{Formal Derivative}- For a polynomial $p(X) \in \F[X]$, we define the formal derivative of $p(X)$ as the polynomial $u(X,X)$ where $u(X,Y)=\frac{p(X)-p(Y)}{X-Y}$\\
Let us denote the formal derivative of $p(X)$ as $p^f(X)$.\\
Then, $p^f(X)= u(X,X)$ where $u(X,Y)=\frac{p(X)-p(Y)}{X-Y}$\\\\
It is well known that the formal derivative of a polynomial satisfies all the properties that we want the derivative of a polynomial to satisfy, like linearity, product rule, quotient rule etc.\\\\
As a result, the formal derivative $p^f(X)$ defined as above can be computed from $p(X)$ in the \textit{usual} way, that is $\frac{d}{dx}X^k=k X^{k-1}$ and extend using linearity of derivative.\\
Henceforth, we will represent the formal derivative of $p(X)$ as $p'(X)$ and because of the above statements, we will compute it in the usual way and freely use all the properties of derivatives on it.\\

\subsection{Some useful lemmas:}

We need the following lemma:\\
\begin{lemma}\label{lem:sumtoder}
For $K\subset [N]$, define $H_K$ to be $\{\xi^i:i \in K\}$. Let $p(X)$ be the vanishing polynomial of $H_{K}$. Let $p'(X)$ and $p''(X)$ denote the formal first derivative and second derivative of $p(X)$ respectively.\\
Then, $p''(\xi^i)/p'(\xi^i)=2 \cdot \sum_{j\in K\setminus \{i\}} 1/(\xi^i-\xi^j)$ for all $i \in K$
\end{lemma}

\begin{proof}

    We have for any $r \in K$:\\
    $p'(\xi^r)=\prod_{j \in K \setminus \{r\}}(\xi^r-\xi^j)$\\
    To compute $p''(\xi^r)$, note that $p''(X)$ is a (double) sum of many products. When one substitutes $\xi^r$ in a product, the product is non zero if and only if $r=i\, \text{or}\, r=j$\\\\

    Putting $\xi^r$ gives:
    $$ p''(\xi^r)=\sum_{j\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,j\}} (\xi^r-\xi^k)+$$
    $$ \sum_{i\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,i\}} (\xi^r-\xi^k) $$
    But this is just,
    $$2\cdot \sum_{j\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,j\}} (\xi^r-\xi^k) $$

    Now, we are left to show that $\frac{\frac{p''(\xi^r)}{2}}{p'(\xi^r})=\sum_{j\in K\setminus \{r\}} 1/(\xi^r-\xi^j)$, or
    $$\sum_{j\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,j\}} (\xi^r-\xi^k)=\prod_{j \in K \setminus \{r\}}(\xi^r-\xi^j) \sum_{j\in K\setminus \{r\}} 1/(\xi^r-\xi^j)$$

    But we observe that:
    $$\sum_{j\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,j\}} (\xi^r-\xi^k)=\sum_{j\in K\setminus \{r\}}\frac{\prod_{k\in K\setminus \{r\}} (\xi^r-\xi^k)}{(\xi^r-\xi^j)}$$

    But $\prod_{k\in K\setminus \{r\}} (\xi^r-\xi^k)$ is independent of $j$, so it can be pulled outside the sum:
    $$\sum_{j\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,j\}} (\xi^r-\xi^k)=\prod_{k\in K\setminus \{r\}} (\xi^r-\xi^k) \sum_{j\in K\setminus \{r\}} 1/(\xi^r-\xi^j) $$
    But $k$ is just a dummy variable. We can replace $k$ by $j$ on the RHS:
    $$\sum_{j\in K\setminus \{r\}}\prod_{k\in K\setminus \{r,j\}} (\xi^r-\xi^k)=\prod_{j\in K\setminus \{r\}} (\xi^r-\xi^j) \sum_{j\in K\setminus \{r\}} 1/(\xi^r-\xi^j) $$
    This completes the proof.
\end{proof}

\textbf{An alternative proof of \ref{lem:sumtoder}}:\\
An alternative proof is possible by inducting on the cardinality of $K\subset N$.\\
The base case where $K$ has one element, say $i$ is trivial. This is because in that case $p$ is a linear polynomial $X-\xi^i$ and LHS=$\frac{p''}{p'}=\frac{0}{1}=0$ and on RHS we are summing over the empty set so the sum is $0$.\\\\
Now let $|K|=k$ and the elements of $K$ be $a_1, a_2, \cdots, a_k$.
Consequently $p(X)=\prod_{i \in K}(X-\xi^i)$\\
We assume that the result holds for this case. Thus,
$$p''(\xi^i)/p'(\xi^i)=2 \cdot \sum_{j\in K\setminus \{i\}} 1/(\xi^i-\xi^j)$$ for all $i \in K$.\\
Suppose we introduce another element in the set $K$, call it $\alpha$
The vanishing polynomial for the new $K$(call it $K')$ is $q(X)=p(X)(X-\xi^{\alpha})$\\
Then by the product rule for derivatives, we have:
$$q'(X)=p'(X)(X-\xi^{\alpha})+p(X)$$ and
$$q''(X)=2p'(X)+p''(X)(X-\xi^{\alpha})$$

It suffices to show that $$\frac{q''(\xi^i)}{q'(\xi^i)}=2\sum_{j\in K'\setminus \{i\}}\frac{1}{\xi^i-\xi^j}$$
for all $i \in K'$\\
For this we make 2 cases:\\
\textbf{Case 1-}$i \in K$
Then
$$q'(\xi^i)=p'(\xi^i)(\xi^i-\xi^{\alpha})$$ and
$$q''(\xi^i)=2p'(\xi^i)+p''(\xi^i)(\xi^i-\xi^{\alpha})$$
This used that $p(\xi^i)=0$\\
Thus, $$\frac{q''(\xi^i)}{q'(\xi^i)}=\frac{2p'(\xi^i)+p''(\xi^i)(\xi^i-\xi^{\alpha})}{p'(\xi^i)(\xi^i-\xi^{\alpha})}$$
Dividing numerator and denominator by $p'(\xi^i)(\xi^i-\xi^{\alpha})$ gives:
$$\frac{q''(\xi^i)}{q'(\xi^i)}=\frac{2}{\xi^i-\xi^\alpha}+\frac{p''(\xi^i)}{p'(\xi^i)}$$
By induction hypothesis this becomes:
$$\frac{q''(\xi^i)}{q'(\xi^i)}=\frac{2}{\xi^i-\xi^\alpha}+2 \cdot \sum_{j\in K\setminus \{i\}} 1/(\xi^i-\xi^j)$$
Note that $$\frac{1}{\xi^i-\xi^\alpha}+ \sum_{j\in K\setminus \{i\}} 1/(\xi^i-\xi^j)=\sum_{j\in K'\setminus \{i\}}\frac{1}{\xi^i-\xi^j}$$
Using that $K'=K \cup \{\alpha\}$\\
Thus, $$\frac{q''(\xi^i)}{q'(\xi^i)}=2\sum_{j\in K'\setminus \{i\}}\frac{1}{\xi^i-\xi^j}$$ which completes case 1. \\\\
\textbf{Case 2-}$i=\alpha$. Then
$$q'(\xi^{\alpha})=p(\xi^{\alpha})$$ and
$$q''(\xi^{\alpha})=2p'(\xi^{\alpha})$$
These we get by replacing $X$ by $\xi^{\alpha}$ in the expressions of $q', q''$
So, it is sufficient to prove that:
$$\frac{2p'(\xi^{\alpha})}{p(\xi^{\alpha})}=2\sum_{j\in K'\setminus \{\alpha\}}\frac{1}{\xi^{\alpha}-\xi^j}$$

But $$p(\xi^{\alpha})=\prod_{i \in K}(\xi^{\alpha}-\xi^i)=\prod_{i \in K'\setminus \{\alpha\}}(\xi^{\alpha}-\xi^i)$$ and $$p'(\xi^{\alpha})=\sum_{j \in K} \prod_{i \in K \setminus \{j\}}(\xi^{\alpha}-\xi^i)=\sum_{j \in K'\setminus \{\alpha\}} \prod_{i \in K' \setminus \{j, \alpha\}}(\xi^{\alpha}-\xi^i)$$
But now, note that $$\sum_{j \in K'\setminus \{\alpha\}} \prod_{i \in K' \setminus \{j, \alpha\}}(\xi^{\alpha}-\xi^i)=\prod_{i \in K' \setminus \{ \alpha\}}(\xi^{\alpha}-\xi^i)\sum_{j \in K'\setminus \{\alpha\}}\frac{1}{\xi^{\alpha}-\xi^j}$$
So, $$\frac{2p'(\xi^{\alpha})}{p(\xi^{\alpha})}=\frac{2\cdot \prod_{i \in K' \setminus \{ \alpha\}}(\xi^{\alpha}-\xi^i)\sum_{j \in K'\setminus \{\alpha\}}\frac{1}{\xi^{\alpha}-\xi^j}}{\prod_{i \in K'\setminus \{\alpha\}}(\xi^{\alpha}-\xi^i)}=$$\\
$$=2\cdot\sum_{j \in K'\setminus \{\alpha\}}\frac{1}{\xi^{\alpha}-\xi^j}$$

This completes the proof of case 2 and thus the proof of the lemma.

\begin{lemma}[Sumcheck]\label{lem:sumcheck}
Let $u(X,Y)$ be a bi-variate polynomial over a finite field $\F$ and $\nroots$ be defined as the group of $N^{\text{th}}$ roots of unity $(N<<|\F|)$ with generator $\xi \in \F$ \\
Then $\sum_{i\in [N]}u(X,\xi^i)= Nu(X,0)$
\end{lemma}

\begin{proof}
    First of all, by a basic result in algebra, $\F[X,Y]=\F[X][Y]$\\
    $u(X,Y) \in \F[X,Y]$ thus $u(X,Y) \in \F[X][Y]$\\
    Let it have degree $d<N$ ($u(X,Y)$ itself had degree less than $N$)
    Thus, $u(X,Y)=a_0+a_1 Y+ a_2 Y^2+\cdots+ a_d Y^d$\\
    Here each $a_i$ is a polynomial function in $X$\\
    Now,  $\sum_{i\in [N]}u(X,\xi^i)$
    $$N a_0+a_1(\xi^+\xi^2+\cdots+\xi^N)+a_2(\xi^2+\xi^4+\cdots+\xi^{2N})+ \cdots + a_d(\xi^d+\cdots +\xi^{Nd})$$
    But for any $\alpha=\xi^k$ for $k<N$, $\alpha+\alpha^2+\cdots \alpha^N=0$ (basic property of complex numbers)\\
    Thus, all terms vanish except the first term\\
    So, $\sum_{i\in [N]}u(X,\xi^i)=N a_0$\\
    But $a_0=u(X, 0)$\\
    Thus, $\sum_{i\in [N]}u(X,\xi^i)=N u(X, 0)$
\end{proof}

\begin{lemma}\label{lem:zk-hat}
Let polynomials $Z_\nroots(X)$ be the vanishing polynomial for $\nroots$, let $\widehat{Z}_K(X)$ and $Z_K(X)$ be the vanishing polynomials for $H_{[N]\setminus K}$ and $H_K$ respectively. Let $\mu_1(X),\ldots,\mu_N(X)$
be Lagrange polynomials for the set $\nroots=\{\xi,\ldots,\xi^N\}$. Then:
\begin{gather}
    \widehat{Z}_K(X) = \sum_{j\in K}\frac{Z_\nroots'(\xi^j)}{Z_K'(\xi^j)}\mu_j(X), \\
    \widehat{Z}_K'(X)= \sum_{j\in K}\frac{Z_\nroots'(\xi^j)}{Z_K'(\xi^j)}\mu_j'(X)
\end{gather}
\end{lemma}
The following fact will be useful in proving the lemma.
\begin{fact}[\textsf{Standard result from Algebra}]
    If $2$ polynomials $f,g$ of degree $<N$ agree on $N$ points, then they are equal as polynomials, that is, $f(X)=g(X)$
\end{fact}

\begin{proof}
    The second equation follows from the first by simple differentiation (linearity of derivative)\\
    It suffices to prove the first equation\\
    Both LHS and RHS are of degree $<N$. We will show that LHS and RHS agree on $N$ points. That will finish proof of (11) by the fact\\
    Consider evaluating LHS and RHS at $\xi^i$ for $i \in [N]\setminus K$ \\
    LHS is 0 by definition of $\hat{Z}_K(X)$. RHS is also 0 by properties of Lagrange polynomials.\\
    Consider evaluating LHS and RHS at $\xi^i$ for $i \in K$\\
    RHS is $\frac{Z_\nroots'(\xi^i)}{Z_K'(\xi^i)}$ by properties of Lagrange polynomials.\\
    LHS is $\prod_{j \in [N]\setminus K} (\xi^i-\xi^j)$\\
    Multiplying dividing by $\prod_{ j \in K \setminus \{i\}}(\xi^i-\xi^j)$ gives:
    $$\frac{\prod_{j \in [N] \setminus \{i\}} (\xi^i-\xi^j)}{\prod_{j \in K \setminus \{i\}}(\xi^i-\xi^j)}$$
    Which is $\frac{Z_\nroots'(\xi^i)}{Z_K'(\xi^i)}$ =RHS\\
    Thus, LHS and RHS of (11) agree on $\nroots$. Thus, they agree on $N$ points
\end{proof}

\begin{lemma}\label{lem:lamda-deriv}
Let $\mu_1,\ldots,\mu_N$ be the lagrange polynomials for the set $\nroots=\{\xi^i:i\in [N]\}$
of the $N^{th}$ roots of unity. Then we have:
\begin{equation*}
    \mu_i'(\xi^j) = \begin{cases}
                        \frac{(N-1)}{2\xi^{i}}  \text{ if } j=i\\
                        \frac{\xi^i}{\xi^j(\xi^j-\xi^i)} \text{ otherwise }
    \end{cases}
\end{equation*}
\end{lemma}

\begin{proof}
    Suppose first that $i \neq j$:\\
    We know that $\mu_i(X)= \frac{Z_H(X)}{Z_H'(\xi^i)(X-\xi^i)}$\\
    Thus, by applying quotient rule(we can apply quotient rule because $\mu_i$ is defined at $\xi^j$ as $j\neq i$):
    $$\mu_i'(X) \cdot Z_H'(\xi^i)= \frac{(X-\xi^i)(N\cdot X^{N-1})-(X^N-1)}{(X-\xi^i)^2}$$
    Substituting $X$ by $\xi^j$, we get:
    $$\mu_i'(\xi^j) \cdot \frac{N}{\xi^i}= \frac{N(\xi^j-\xi^i)}{\xi^j (\xi^j-\xi^i)^2}$$
    Thus, we get:
    $$\mu_i'(\xi^j)=\frac{\xi^i}{\xi^j(\xi^j-\xi^i)}$$\\
    Now consider $i=j$:\\
    Then, $\mu_i(X)=\frac{\prod_{j \in [N] \setminus \{i\}}(X-\xi^j)}{Z_H'(\xi^i)}$\\
    Thus,  $\mu_i(X)\cdot Z_H'(\xi^i)=\prod_{j \in [N] \setminus \{i\}}(X-\xi^j)$\\
    Thus, $\mu_i'(X) \cdot \frac{N}{\xi^i}=\sum_{j \in [N] \setminus \{i\}}\prod_{k \in [N]\setminus\{i,j\}}(X-\xi^k)$\\
    Now, substituting $X$ by $\xi^i$ gives:
    $$\mu_i'(\xi^i) \cdot \frac{N}{\xi^i}=\sum_{j \in [N] \setminus \{i\}}\prod_{k \in [N]\setminus\{i,j\}}(\xi^i-\xi^k)$$
    or
    $$\mu_i'(\xi^i) \cdot \frac{N}{\xi^i}=\sum_{j \in [N] \setminus \{i\}}\frac{\prod_{k \in [N]\setminus\{i\}}(\xi^i-\xi^k)}{\xi^i-\xi^j}$$
    or$$\mu_i'(\xi^i) \cdot \frac{N}{\xi^i}= \prod_{k \in [N]\setminus\{i\}}(\xi^i-\xi^k)\sum_{j\in [N]\setminus \{i\}}\frac{1}{\xi^i-\xi^j}$$
    or $$\mu_i'(\xi^i) \cdot \frac{N}{\xi^i}=Z_H'(\xi^i)\sum_{j\in [N]\setminus \{i\}}\frac{1}{\xi^i-\xi^j}$$
    or $$\mu_i'(\xi^i)=\sum_{j\in [N]\setminus \{i\}}\frac{1}{\xi^i-\xi^j}$$
    or $$\mu_i'(\xi^i)=\frac{Z_H''(\xi^i)}{2 Z_H'(\xi^i)} \text{ From the lemma \ref{lem:sumtoder}}$$
    or $$ \mu_i'(\xi^i)=\frac{N-1}{2\xi^i}$$

\end{proof}

\begin{lemma}\label{lem:tau}
Let $K\subseteq \F$ be a set of cardinality $k$ and $\mathcal{X}=\{x_j:j\in K\}$ be a set
where $x_j$ for $j\in K$ are distinct elements of $\F$. Let $Z_\mathcal{X}(X)=z_k X^k+\cdots+z_0$ denote the vanishing polynomial of $\mathcal{X}$
and $\{\eta_j(X)\}_{j\in K}$ denote the lagrange polynomials such that $\eta_i(x_j)=\delta_{ij}$ for $i,j\in K$. Then for all $j\in K$,
we have $\eta_j'(x_j)=F_K(x_j)/Z_\mathcal{X}'(x_j)$ where the polynomial
$F_K(X)$ is defined as
\[F_K(X)=\binom{k}{2}z_k X^{k-2}+\cdots+\binom{2}{2}z_2=\sum_{j=2}^k z_j\binom{j}{2}X^{j-2} \]
\end{lemma}
\begin{proof}
    For $j\in K$ we have $\tau_j(X)=\frac{Z_\mathcal{X}(X)}{(X-x_j)Z_\mathcal{X}'(x_j)}= \frac{1}{Z_\mathcal{X}'(x_j)}\frac{Z_\mathcal{X}(X)}{X-x_j}$ by definition of Lagrange polynomials.\\
    By doing long division of $Z_\mathcal{X}(X)$
    by $X-x_j$ we have:
    \begin{align*}
        \tau_j(X) &= \frac{1}{Z_\mathcal{X}'(x_j)}\big(z_k X^{k-1} + (x_jz_k + z_{k-1})X^{k-2} + \cdots\\ +
        (x_j^{k-1}z_k + \cdots + z_1)\big)
        &= \frac{1}{Z_\mathcal{X}'(x_j)}\sum_{p=0}^{k-1} \left(\sum_{q=p+1}^k z_q x_j^{q-p-1}\right)X^p
    \end{align*}

    Now, we use linearity property of derivative to differentiate:

    $$   \tau_j'(X) = \frac{1}{Z_\mathcal{X}'(x_j)}\sum_{p=0}^{k-1} \left(\sum_{q=p+1}^{k}z_q x_j^{q-p-1}\right)p X^{p-1} $$
    In this step we just differentiated $X^p$ to get $p X^{p-1}$
    $$ \tau_j'(X) = \frac{1}{Z_\mathcal{X}'(x_j)}\sum_{p=1}^{k-1} p  \sum_{q=p+1}^{k}z_q x_j^{q-p-1} X^{p-1} $$
    In this step, we just applied distributive property to the rightmost bracket and brought $p$ outside the sum over $q$\\
    Now we put $X=x_j$:

    $$\tau_j'(x_j) = \frac{1}{Z_\mathcal{X}'(x_j)} \sum_{p=1}^{k-1} p \sum_{q=p+1}^k z_q x_j^{q-2} $$
    $$= \frac{1}{Z_\mathcal{X}'(x_j)}\sum_{q=2}^k z_q x_j^{q-2} \sum_{p=1}^{q-1} p $$
    Here, we reversed the order of the sum. $p$ going from 1 to $k-1$ and $q$ going from $p+1$ to $k$ is same as $q$ going from $2$ to $k$ and $p$ going from 1 to $q-1$
    $$\tau_j'(x_j)= \frac{1}{Z_\mathcal{X}'(x_j)}\sum_{q=2}^k z_q \binom{q}{2} x_j^{q-2} $$
    Here we used that $\sum_{p=1}^{q-1}p=\frac{q(q-1)}{2}=\binom{q}{2}$

    But $q$ is just a dummy variable. We might as well replace $q$ by $j$

    Thus, $$\tau_j'(x_j)= \frac{1}{Z_\mathcal{X}'(x_j)}\sum_{j=2}^k z_j \binom{j}{2} x_j^{j-2} $$
    If we compare this to the definition of $F_K(X)$ given in the lemma statement, we get:
    $$\tau_j'(x_j)= \frac{F_K(x_j)}{Z_\mathcal{X}'(x_j)}$$


\end{proof}

\subsection{Brief Proof Summary of lemma \ref{lem:sum computation}}
What we want to compute is a sum over the set $K$ for all $i \in I$ or a sum over the set $I$ for all $j \in K$. Let us give a sketch for the first case.

We interpolate a polynomial $p$ in such a way that its evaluations at $\nroots$ correspond to the numerators of the required sum. We take the full $\nroots$ and not subsets of it so that we can apply sumcheck easily later. \\
Next we introduce some rational functions. These will be very useful to reduce the sum we need to compute to an evaluation of the rational functions at some points\\


These evaluations can be reduced to evaluations of polynomials using the simple form of $Z_{\nroots}$. \\

By introducing some more polynomials and using formulas for sumcheck, finally, the entire task can be reduced to calculating $p(0)$ and $p'(X)$ at certain points. \\

The polynomial $p$ turns out to be a product of polynomials: $p(X)=\widehat{Z}_K(X)\cdot q(X)$ and so the next step is to get the evaluations of $\widehat{Z}_K(X)$ and $q(X)$ at those points.
For this, some further lemmas are used to get evaluations of $q(X)$ at degree $q$ many points and thus $q(X)$ is obtained by interpolation. \\
Next $q(0)$ can be computed and thus $p(0)$ is also computed.\\
$Z_K(X)$ and $q'(X)$ can also be computed easily(details in the proof)\\
This leaves computation of $\widehat{Z}_K(X)$ at those points as the main task. For this another lemma is needed related to derivatives of Lagrange polynomials. \\
Eventually the task reduces to needing to compute something which can be computed efficiently using another lemma.\\
Moreover, every single step involves a reduction which can be done in the number of operations allowed in the statement of the lemma. So, we get what we want.\\
For the second case, the proof is very similar, except for some interchanging of $I$ and $K$, and interchanging of $i$ and $j$. \\
This completes a brief summary of the proof.
\subsection{Proof of lemma \ref{lem:sum computation}}

\begin{proof}

    We give the proof for $e_i$ for all $i \in \setind$ in full detail and briefly mention the modifications needed for $b_j$ for all $j \in K$. \\

    \begin{equation}\label{eq:ei}
    e_i = \sum_{j\in K\setminus \{i\}} \frac{\Delta t_j}{\xi^i - \xi^j}
    \end{equation}
    We need this for all $i \in \setind$. Recall that $\setind \subset K$ in this case.\\
    To compute $e_i$, we will first define a polynomial $p(X)$ of degree at most $N-1$ such that
    $p(\xi^j)=\Delta t_j$ for $j\in K$ and $p(\xi^j)=0$ for $j \in [N]\setminus K$.\\
    Now, because $p(\xi^j)=0$ for $j \in [N]\setminus K$, it is clear that the vanishing polynomial of $H_{[N]\setminus K}$ divides $p(X)$.\\\\

    Thus, there exists a polynomial $q(X)$ of degree at most $|K|-1$ such that:
    \begin{equation}\label{eq:px}
    p(X) = \hat{Z}_K(X)\cdot q(X)
    \end{equation}
    where $\hat{Z}_K(X)=\prod_{i\in [N]\setminus K}(X-\xi^i)$ is the vanishing polynomial of $H_{[N]\setminus K}$\\

    Now introduce the rational functions:
    \begin{gather}\label{eq:fgr}
    f_i(X) = \sum_{j\in [N]\setminus \{i\}}\frac{p(\xi^j)}{X-\xi^j}, i\in \setind \\
    g_i(X) = \sum_{j\in [N]\setminus \{i\}}\frac{p(X)}{X-\xi^j}, i\in \setind \\
    r_i(X) = \sum_{j\in [N]\setminus \{i\}}\frac{p(X) - p(\xi^j)}{X-\xi^j}, i\in \setind
    \end{gather}
    Note that $f_i(\xi^i)=\sum_{j\in [N]\setminus \{i\}}\frac{p(\xi^j)}{\xi^i-\xi^j}$\\\\
    But, by the way $p(X)$ is defined, we have that $f_i(\xi^i)=\sum_{j\in K\setminus \{i\}}\frac{\Delta t_j}{\xi^i-\xi^j}=e_i$\\
    \textbf{Thus, we need $f_i(\xi^i)$ for all $i \in I$.}

    Note that $f_i(X) = g_i(X) - r_i(X)$ for $i\in I$\\
    Thus, $e_i=g_i(\xi^i)-r_i(\xi^i)$\\
    Thus, we need to compute $g_i(\xi^i)$ and $r_i(\xi^i)$ for all $i \in I \subset K$
    \begin{align*}
        g_i(\xi^i) &= p(\xi^i)\sum_{j\in [N]\setminus \{i\}} \frac{1}{\xi^i-\xi^j} \\
        &= \frac{p(\xi^i)Z_{\nroots}''(\xi^i)}{2 Z_{\nroots}'(\xi^i)} \text{From lemma \ref{lem:sumtoder}} \\
        &= \frac{(N-1)\Delta t_i}{2\xi^i}
    \end{align*}

    We used the fact that $Z_H(X)=X^N-1$ and that $p(\xi^i)=\Delta t_i$.\\
    Thus, in $O(|\setind|)$ operations, we get $g_i(\xi^i)$ for all $i$\\
    If we get $r_i(\xi^i)$ for all $i \in \setind$, then getting $f_i(\xi^i)$ will take only $O(|\setind|)$ operations\\\\
    \textbf{So, it suffices to compute $r_i(\xi^i)$ for all $i \in I$}\\

    First of all, we write $r_i(X)$ as:
    \begin{align}\label{eq:rx}
    r_i(X) &= \sum_{j\in [N]}\frac{p(X)-p(\xi^j)}{X-\xi^j} - \frac{p(X)-p(\xi^i)}{X-\xi^i} \nonumber \\
    \intertext{Now, defining the bivariate polynomial $u(X,Y)=(p(X) - p(Y))/(X-Y)$ gives:}
    &r_i(X)= \sum_{j\in [N]}u(X,\xi^j) - u(X,\xi^i) \nonumber
    \end{align}
    Now, define $r(X)=\sum_{j\in [N]}u(X,\xi^j)$\\
    Thus, we get:\\
    $$r_i(X)=r(X)-u(X, \xi^i)$$
    or
    $$r_i(\xi^i)=r(\xi^i) - u(\xi^i,\xi^i)$$
    But, by definition and properties of formal derivative, we have the following polynomial identity
    $$u(X, X)= p'(X)$$
    where $p'(X)$ denotes the derivative of the polynomial $p(X)$ computed in the usual way. Thus, $u(\xi^i, \xi^i)=p'(\xi^i)$\\

    Thus, we have that:
    $$r_i(\xi^i)=r(\xi^i) - p'(\xi^i) $$

    \textbf{Thus, $r_i(\xi^i)$ for all $i \in \setind$ can be computed by evaluating polynomials $r(X)$ and $p'(X)$ at the set $H_{\setind}$}


    Now, from Lemma \ref{lem:sumcheck}, we have that $r(X)=N u(X,0)=N \frac{(p(X) - p(0))}{X}$ and thus $r(\xi^i)$ for $i\in \setind$ is given by:
    $$r(\xi^i)=N \frac{(\Delta t_i - p(0))}{\xi^i}$$
    If we get $p(0)$, then we can get $r(\xi^i)$ for all $i$ in $O(m)$ operations.\\\\
    \textbf{Thus, it suffices to compute $p(0)$ and $p'(X)$ at the set $\{\xi^i:i \in I\}$}\\\\

    Let $p(X)=\widehat{Z}_K(X)\cdot q(X)$
    as in Equation \eqref{eq:px} and let $Z_K(X)$ be the vanishing polynomial for $H_K$\\
    Note that $Z_K(X) \cdot \hat{Z}_K(X)=X^N-1$(by definition)\\

    Notice that $Z_\nroots'(\xi^j)= \frac{N}{\xi^j} $\\
    Moreover, $Z_K(X)$ can be computed by fast multiplication in $O(|K|\log^2 |K|)$ operations and then it can be differentiated monomial by monomial to get $Z_K'(X)$. \\
    Then, we can do fast evaluation to get $Z_K'(X)$ at $\{\xi^j:j\in K\}$ in $O(|K|\log^2 |K|)$ operations\\
    Recall the lemma \ref{lem:zk-hat} which tells us that $\hat{Z}_K(\xi^j)=\frac{Z_{\nroots}'(\xi^j)}{Z_K'(\xi^j)}$.\\
    Thus, we can compute $\hat{Z}_K(\xi^j)=\frac{\frac{N}{\xi^j}}{Z_K'(\xi^j)}$ for all $j \in K$\\\\
    Now, recall from \eqref{eq:px} that $q(\xi^j)=\frac{p(\xi^j)}{\hat{Z}_K(\xi^j)}=\frac{\Delta t_j}{\widehat{Z}_K(\xi^j)}$\\
    So, we can compute $q(\xi^j)$ for all $j \in K$. \\
    As degree of $q(X)$ is strictly less than $|K|$ we can interpolate to get $q(X)$ in $O(|K|\log^2 |K|)$ field operations. \\
    Again by differentiating monomial by monomial, we get $q'(X)$ and by fast evaluation we can get evaluations of $q'(X)$ at $\xi^i$ for all $i \in I$, again in $O(|K|\log^2 |K|)$ field operations.\\\\

    Now we can compute $p(0)$\\
    Consider $p(0)=q(0)\cdot \hat{Z}_K(0)$\\
    But $\hat{Z}_K(0)=\frac{Z_H(0)}{Z_K(0)}=\frac{-1}{Z_K(0)}$\\
    But this can be computed as we know $Z_K(X)$ and $Z_K(0)$ is just its constant term.\\
    Similarly, we know $q(X)$ so can compute $q(0)$ as it is just the constant term. \\
    Thus, we get $p(0)$\\
    \textbf{Now it remains to compute $p'(X)$ at $\{\xi^i:i \in I\}=H_I$\\\\}
    For this, by product rule of derivatives, $p'(X)=q(X) \hat{Z}_K'(X)+q'(X) \hat{Z}_K(X)$\\

    Thus, to get $p'(X)$ at $H_I$, we need $q, q', \hat{Z}_K$ and $\hat{Z}_K'$ at $H_I$. If we get these, then in $O(|I|)$ operations we would get $p'(X)$ at $H_I$.\\
    Whatever we have done so far has given us $q, q', \hat{Z}_K$ at $H_I$\\\\
    \textbf{So, it suffices to compute $\hat{Z}_K'(X)$ at $H_I$\\}

    For this, we recall the second equation of lemma \ref{lem:zk-hat} and replace $X$ by $\xi^i$ to get:\\
    $$  \widehat{Z}_K'(\xi^i) = \sum_{j\in K\setminus \{i\}} \frac{Z_\nroots'(\xi^j)}{Z_K'(\xi^j)}\mu_j'(\xi^i) + \frac{Z_\nroots'(\xi^i)}{Z_K'(\xi^i)}\mu_i'(\xi^i)$$
    This we got by splitting the sum $j \in K$ into 2 sums, one with $j \in K \setminus \{i\}$ and another with $j=i$

    Using lemma \ref{lem:lamda-deriv}, this becomes:
    $$ \widehat{Z}_K'(\xi^i)= N\xi^{-i}\sum_{j\in K\setminus \{i\}}\frac{1}{Z_K'(\xi^j)(\xi^i-\xi^j)} + \frac{N(N-1)}{2\xi^{2i}Z_K'(\xi^i)}$$


    So, if we can compute $\sum_{j\in K\setminus \{i\}}\frac{1}{Z_K'(\xi^j)(\xi^i-\xi^j)}$ for all $i \in I$, then in $O(|I|)$ operations, we will get $\hat{Z}_K'(\xi^i)$ for all $i \in I$ which is what we want.\\

    Let $$\varphi_i=\sum_{j\in K\setminus \{i\}}\frac{1}{Z_K'(\xi^j)(\xi^i-\xi^j)}$$\\\\
    Thus,\textbf{ it suffices to compute $\varphi_i$ for all $i \in I$}\\\\

    Define:
    $$ \Phi_i(X) = \sum_{j\in K\setminus \{i\}} \frac{1}{Z_K'(\xi^j)(X-\xi^j)} $$
    at $X=\xi^i$. Then it is clear that $\varphi_i=\Phi_i(\xi^i)$.\\\\
    Let $\{\eta_i(X)\}_{i\in K}$ be the Lagrange polynomials for the set $\{\xi^i:i\in K\}= H_K$. \\\\
    Then, $\eta_j(X)=\frac{Z_K(X)}{Z_K'(\xi^j)(X-\xi^j)}$.\\
    Thus, $\frac{\eta_j(X)}{Z_K(X)}=\frac{1}{Z_K'(\xi^j)(X-\xi^j)}$\\
    Thus, $\Phi_i(X)$ can be rewritten as:
    $$\Phi_i(X)=\sum_{j\in K\setminus \{i\}} \frac{\eta_j(X)}{Z_K(X)}$$


    or  $$\Phi_i(X)
    = \sum_{j\in K\setminus \{i\}} \frac{\eta_j(X)/(X-\xi^i)}{Z_K(X)/(X-\xi^i)}$$

    We need to compute $\varphi_i=\Phi_i(\xi^i)$ for all $i \in I$


    Thus, putting $X=\xi^i$ in the above, we have:

    $$\varphi_i = \Phi_i(\xi^i) = \left(\sum_{j\in K\setminus \{i\}}\frac{\eta_j(X)/(X-\xi^i)}{Z_K(X)/(X-\xi^i)}\right)(\xi^i)$$
    This can be simplified as:
    $$\varphi_i = \Phi_i(\xi^i) = \left(\sum_{j\in K\setminus \{i\}}\frac{\eta_j(X)/(X-\xi^i)}{\prod_{j \in K \setminus \{i\}}(X-\xi^j)}\right)(\xi^i)$$
    or $$\varphi_i = \Phi_i(\xi^i) = \sum_{j\in K\setminus \{i\}}\left(\frac{\eta_j(X)/(X-\xi^i)}{\prod_{j \in K \setminus \{i\}}(X-\xi^j)}\right)(\xi^i)$$
    or $$\varphi_i = \Phi_i(\xi^i) = \sum_{j\in K\setminus \{i\}}\frac{\left(\eta_j(X)/(X-\xi^i)\right)(\xi^i)}{\left(\prod_{j \in K \setminus \{i\}}(X-\xi^j)\right)(\xi^i)}$$
    or $$\varphi_i =\Phi_i(\xi^i) =  \frac{1}{Z_K'(\xi^i)}\sum_{j\in K\setminus \{i\}}\left(\eta_j(X)/(X-\xi^i)\right)(\xi^i)$$

    Now, $$ \left(\eta_j(X)/(X-\xi^i)\right)(\xi^i)=\left(\frac{Z_K(X)}{(X-\xi^j)(X-\xi^i)Z_K'(\xi^j)}\right)(\xi^i)$$
    or $$\left(\eta_j(X)/(X-\xi^i)\right)(\xi^i)= \frac{Z_K'(\xi^i)}{(\xi^i-\xi^j)Z_K'(\xi^j)}$$

    But if we compute, $\eta_j'(\xi^i)$ by quotient rule, we get:
    $$\eta_j'(\xi^i)=\frac{Z_K'(\xi^i)}{(\xi^i-\xi^j)Z_K'(\xi^j)}$$
    Thus,
    $$\left(\eta_j(X)/(X-\xi^i)\right)(\xi^i)=\eta_j'(\xi^i) $$
    As both are separately equal to $\frac{Z_K'(\xi^i)}{(\xi^i-\xi^j)Z_K'(\xi^j)}$.\\
    Thus, we get:


    $$\varphi_i =\Phi_i(\xi^i) =  \frac{1}{Z_K'(\xi^i)}\sum_{j\in K\setminus \{i\}}\eta_j'(\xi^i)$$
    But, $$\sum_{j\in K\setminus \{i\}}\eta_j'(\xi^i)= \sum_{j\in K}\eta_j'(\xi^i)-\eta_i'(\xi^i)=-\eta_i'(\xi^i)$$
    using that the sum of Lagrange polynomials is $1$ and thus the sum of the derivatives of the Lagrange polynomials is $0$(section A.1)

    Thus,
    $$\varphi_i =\Phi_i(\xi^i) = \frac{-\eta_i'(\xi^i)}{Z_K'(\xi^i)}$$

    If we get $\eta_i'(\xi^i)$ for all $i\in \setind$, then as we already have $Z_K'(\xi^i)$ for all $i \in I$, we get $\varphi_i$ for all $i \in I$ in $O(|I|)$ computations which is what we need.


    \textbf{Thus, it suffices to efficiently compute $\eta_i'(\xi^i)$ for $i\in \setind$}

    For this recall Lemma \ref{lem:tau} and observe that in our setting $\mathcal{X}$ is just $H_K$, $x_j$ are $\xi^j$ and $Z_\mathcal{X}(X)$ which is the vanishing polynomial of $H_K$ is just $Z_K(X)$. The $\eta_i$ in the lemma are the Lagrange polynomials corresponding to $\mathcal{X}=H_K$ so they are same as the $\eta_i$ in our setting\\\\
    Thus, we get:\\
    $$\eta_i'(\xi^i)=\frac{F_K(\xi^i)}{Z_K'(\xi^i)}$$

    $Z_K'(\xi^i)$ we already have for all $i \in I$\\
    If we get $F_K(\xi^i)$ for all $i \in I$, we will be able to get $\eta_i'(\xi^i)$ for all $i \in I$ in $O(|I|)$ operations which is what we want\\\\

    \textbf{Thus, it suffices to compute $F_K(\xi^i)$ for all $i \in I$}\\\\

    But now recall the definition $F_K$. To compute this, we need information about $z_0, z_1, z_2, \cdots, z_k$.\\
    But, we know the polynomial $Z_K$(fast multiplication) hence we know $z_0, z_1, \cdots, z_{k}$\\
    Thus, we get the coefficients of the polynomial $F_K(X)$, hence the polynomial $F_K(X)$\\\\
    Now, by fast evaluation, we can get $F_K(\xi^i)$ for all $i \in I$. This will take $O(|K| \log^2|K|)$ field operations. \\
    \textbf{Thus, we have computed $F_K(\xi^i)$ for all $i \in I$}\\

    This completes the proof for $e_i$ (Note that in the proof we throughout used that $|\setind| \leq |K|$ so that the various $O(|\setind|)$ operations do not contribute to the final complexity) \\\\

    For the case of $b_j$, notice first that it is very similar to the case of $e_i$ except that the roles of $\setind$ and $K$ are reversed and $i$ and $j$ are reversed.

    First of all define $c_i$ for $i$ outside $\setind$ to be 0. For $i \in \setind$, we already know what $c_i$ is(can be computed by fast evaluation).
    Next, define polynomial $p$ of degree atmost $N-1$ such that $p(\xi^i)=c_i$ for all $i \in [N]$.\\

    From here on, we proceed exactly as we did for the $e_i$ case, replacing every $\setind$ with $K$, every $K$ with $\setind$, every $i$ with $j$ and every $j$ with $i$\\

    All the required lemmas are also modified in this way.

    We reach till
    $$\Phi_j(X)=\sum_{i\in I\setminus \{j\}} \frac{\eta_i(X)}{Z_I(X)}$$
    and we need to compute $\varphi_j=\Phi_j(\xi^j)$ for all $j \in K$.\\

    Here, we deviate: For $j \in K\setminus I$, we can very easily compute $\varphi_j=\Phi_j(\xi^j)$ as
    $$\Phi_j(\xi^j)=\sum_{i\in I\setminus \{j\}} \frac{\eta_i(\xi^j)}{Z_I(\xi^j)}$$
    or
    $$\Phi_j(\xi^j)=\frac{1}{Z_I(\xi^j)} \sum_{i\in I}\eta_i(\xi^j)$$
    or
    $$\Phi_j(\xi^j)=\frac{1}{Z_I(\xi^j)}$$

    Using that the sum of all Lagrange polynomials is $1$

    \textbf{So, it suffices to compute $\varphi_j$ for all $j \in \setind$}

    Now, again continue exactly as in the $e_i$ case until we reach:
    $$\varphi_j =\Phi_j(\xi^j) = \frac{-\eta_j'(\xi^j)}{Z_I'(\xi^j)}$$
    for all $j \in \setind$\\

    But $Z_I'(\xi^j)$ we would have already computed for all $j \in \setind$ (fast multiplication and fast evaluation). \\

    \textbf{So, it suffices to compute $-\eta_j'(\xi^j)$ for all $j \in \setind$\\}
    But we computed $\eta_i'(\xi^i)$ for $i\in \setind$ during the computation of $e_i$. Just reuse whatever we got!\\

    This completes the computation for $b_j$ for all $j \in K$.
    Thus, this finishes the proof of lemma \ref{lem:sum computation}
\end{proof}

\section{Reducing indexed lookups to subvector lookups}\label{sec:generic-transformation-app}
Let us say we have a subvector lookup argument $L$ which takes as input two vectors say $a, b$ and determines whether $b$ is a subvector of $a$. It outputs $1$ if $b$ is a subvector of $a$ and $0$ if $b$ is not a subvector of $a$. \\
Recall that $b$ is said to be a subvector of $a$ if every element of $b$ is in $a$\\\\


Indexed lookup argument $L'$ takes in 3 vectors $a, b, c$ where $c$ is a vector of indices with $|b|=|c|$ and checks that $b$ is a subvector of $a$ and that $a[c_i]=b_i$ for all $i$. That is, it does $L(a, b)$ first and further checks that $a$ restricted to the indices in $c$(in a particular order) gives $b$(in that particular order).\\
If $b$ is a subvector of $a$ and $a[c_i]=b_i$ for all $i$ then it outputs $1$ else it outputs $0$.\\

\textbf{Note:} Given $a,b$ with $b$ subvector of $a$, there will always exist a $c$ with $|c|=|b|$ such that $a[c_i]=b_i$ for all $i$. The $c$ may not be unique though. \\\\
So, we are given $T, v, a$ with $|a|=|v|$ and we want to compute $L'(T, v, a)$ using $L(\cdot, \cdot)$. \\
Let $|T|=N$. Let $|v|=m=|a|$.
Procedure to compute $L'(T, v, a)$ is as follows:
\begin{itemize}
    \item First compute $L([N], a)$. This checks that $a$ is indeed a vector of indices. Call the output of this as $b_1$
    \item Next compute $L(T, v)$. This checks that $v$ is indeed a subvector of $T$. Call the output of this as $b_2$
    \item Choose a $\gamma$ uniformly at random from $\F^*$
    \item Compute $L(T+\gamma[N], v+\gamma a)$ which checks that $v+\gamma a$ is a subvector of $T+\gamma [N]$. Call the output $b_3$.
    \item $L'(T, v, a)$ is then computed as $b_1 \wedge b_2 \wedge b_3$
\end{itemize}
This procedure works for any $T,v,a$ with $|v|=|a|$. So, this gives a procedure for calculating $L'(\cdot, \cdot, \cdot)$.

\begin{lemma}\label{lem:reduction}
Let the procedure for getting $L'(\cdot, \cdot, \cdot)$ be as above. Then, if $L(\cdot, \cdot)$ is a valid subvector lookup argument then the procedure yields a valid indexed lookup argument $L'(\cdot, \cdot, \cdot)$ with an error probability upper bounded by $\frac{O(1)}{|\F|}$.
\end{lemma}

\begin{proof}
    To show that the procedure yields a valid indexed lookup argument $L'(T, v, a)$, we need to show the following:
    \begin{enumerate}

        \item If $v$ is indeed a subvector of $T$ with $T$ restricted to $a$ giving $v$, then $b_1=b_2=b_3=1$ with probability lower bounded by $1-\frac{O(1)}{|\F|}$
        \item If either $v$ is not a subvector of $T$ or if $v$ is a subvector of $T$ but restriction of $T$ to $a$ is not $v$, then at least one of $b_1, b_2, b_3$ is $0$ with probability lower bounded by $1-\frac{O(1)}{|\F|}$
    \end{enumerate}

    For 1., suppose $v$ is a subvector of $T$ with $T$ restricted to $a$ giving $v$. Then $L(T, v)=b_2=1$. \\
    Moreover, $a$ is a subvector of $[N]$(else restricting $T$ to $a$ won't even make sense). \\
    So, $L([N], a)=b_1=1$ \\
    Lastly, since $v_i=T[a_i]$ for all $i \in m$, we have that for any $\gamma \in \F^{*}$,
    $$T[a_i]+\gamma a_i=v_i+\gamma a_i$$ for all $i$ \\
    But $T[a_i]+\gamma a_i$ is of course an element of $T+\gamma [N] $ for all $i \in [m]$.(Every $a_i \in [N]$)\\
    So, $\{T[a_i]+\gamma a_i:i \in [m]\}$ is a subvector of $T+\gamma [N] $.\\
    Thus, $\{v_i+\gamma a_i:i \in [m]\}$ is a subvector of $T+\gamma [N] $.\\
    So, $v+\gamma a$ is a subvector of $T+\gamma [N] $.\\
    Thus, $L(T+\gamma[N], v+\gamma a)=b_3=1$

    This completes proof of 1.(In this case the probability is actually 1) \\\\
    For proof of 2., if $v$ is not a subvector of $T$ then $L(T, v)=b_2=0$ with probability 1 and we are done \\
    So let us assume that $v$ is a subvector of $T$ and restriction of $T$ to $a$ is not $v$.\\
    If $a$ is not a vector of indices (that is, some $a_i \notin [N]$) then $L([N], a)=b_1=0$ with probability 1 and we are done. \\
    So, let us assume that $a$ is a vector of indices (of course by definition of $L'$, we have that $|a|=|v|=m$).\\

    \textbf{It suffices to show that $L(T+\gamma[N], v+\gamma a)=b_3$ is 0 with probability lower bounded by $1-\frac{O(1)}{|\F|}$.}

    Since $v$ is a subvector of $T$ there is a restriction of $T$ which gives $v$. Say the restriction is $b$. Then $|b|=|v|=m$ and $T[b_i]=v_i$ for all $i \in [m]$. \\
    Moreover, by our assumption that restriction of $T$ to $a$ is not $v$, we have that $a \neq b$. \\
    But $a\neq b$ implies there exists a $k \in [m]$ such that $a_k\neq b_k$.\\
    As restriction of $T$ to $a$ is not $v$, there exists a $k \in [m]$ such that $T[a_k]\neq v_k$\\
    Let $I=\{k \in [m]: T[a_k]\neq v_k\}$\\
    By the fact that restriction of $T$ to $a$ is not $v$ , $I \neq \phi$\\
    Also, $I \subset [N]$\\
    By well ordering principle, $I$ has a smallest element, say $i$.\\
    Then for this $i$, $T[a_i]\neq v_i$. Moreover, as $v_i=T[b_i]$; $a_i \neq b_i$ \\
    Let $\gamma$ be picked uniformly at random from $\F^*$\\
    Consider the vector $T+\gamma[N]$. Once $\gamma$ has been chosen, this is a fixed vector. \\
    Also, consider the vector $v+\gamma a$. One of the elements in this vector is $v_i +\gamma a_i$.\\
    We will upper bound the probability that this element is an element of the vector $T+\gamma[N]$. \\\\
    $$\Pr[v_i +\gamma a_i \in T+\gamma[N]]=\Pr[\exists j \in [N] \ni v_i +\gamma a_i=T[j]+\gamma j]$$
    But by union bound:
    $$\Pr[\exists j \in [N] \ni v_i +\gamma a_i=T[j]+\gamma j] \leq \sum_{j=1}^N \Pr[v_i +\gamma a_i=T[j]+\gamma j]$$
    Thus,
    $$\Pr[v_i +\gamma a_i \in T+\gamma[N]] \leq \sum_{j=1}^N \Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right] $$

    Let $M'$ be defined as $M'=\{j\in [N] \ni T[j]=v_i \}$ \\
    Let $M$ be defined as $M' \cup \{a_i\}$. Clearly $M \subset [N]$\\
    But now, consider $\frac{T[j]-v_i}{a_i-j}$. For $j=a_i$ this is not defined. And for $j$ such that $T[j]=v_i$, this is 0. So, for such values of $j$, probability that $\gamma$ equals to it is $0$.\\
    For other values of $j$, $\frac{T[j]-v_i}{a_i-j}$ is an element of $\F^{*}$ and since $\gamma$ is a random element of $F^{*}$, the probability that $\gamma$ equals to it is $\frac{1}{|\F|-1}$\\
    In other words,
    $$\Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right]=\frac{1}{|\F|-1}$$ for $j \in [N]\setminus M$
    $$\Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right]=0$$ for $j \in M$

    Thus, we get that:
    $$\Pr[v_i +\gamma a_i \in T+\gamma[N]] \leq \sum_{j \in [N]\setminus M} \Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right]+$$
    $$\sum_{j \in M} \Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right]=\sum_{j \in [N]\setminus M} \Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right]$$
    $$=\sum_{j \in [N]\setminus M} \frac{1}{|\F|-1}=\frac{|[N]\setminus M|}{|\F|-1} \leq \frac{N-2}{|\F|-1}$$
    We used first that $[N]\setminus M$ and $M$ are disjoint and union is $[N]$, then we used the above equalities for $\Pr\left[\gamma = \frac{T[j]-v_i}{a_i-j}\right]$ and finally used that $|M| \geq 2$ as $M$ atleast contains $a_i$ and $b_i$.\\
    So we have obtained:
    $$\Pr[v_i +\gamma a_i \in T+\gamma[N]] \leq \frac{N-2}{|\F|-1}$$
    All this was done for the smallest element $i$ of the set $I$.\\
    For $v+\gamma a$ to be a subvector of $T+\gamma [N]$, we need that:
    $$v_i +\gamma a_i \in T+\gamma[N]$$ for all $i \in I$\\
    But observe that,
    $$\Pr[v_i +\gamma a_i \in T+\gamma[N] \, \text{for all} \, i \in I] \leq \Pr[v_i +\gamma a_i \in T+\gamma[N]] \leq \frac{N-2}{|\F|-1}$$
    So, we have that $$\Pr[v_i +\gamma a_i \in T+\gamma[N] \, \text{for all} \,i \in I] \leq \frac{N-2}{|\F|-1}$$
    So, the probability that $v+\gamma a$ is a subvector of $T+\gamma [N]$ is upper bounded by $\frac{N-2}{|\F|-1}$. \\
    But $N <<|\F|$. So, $\frac{N-2}{|\F|-1}$ is $\frac{O(1)}{|\F|}$. \textbf{Thus, the error probability is upper bounded by $\frac{O(1)}{|\F|}$} \\
    So, with a probability of atleast $(1-\frac{N-2}{|\F|-1})$, $v+\gamma a$ is not a subvector of $T+\gamma [N]$. \\
    So, $L(T+\gamma[N], v+\gamma a)=b_3$ is 0 with probability lower bounded by $1-\frac{O(1)}{|\F|}$ \\
    This completes the proof of lemma \ref{lem:reduction}
\end{proof}